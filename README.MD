# Shadowsocks With Cloak Plugin Installer
A script to install shadowsocks with cloak plugin in your server.

## Why this installer?
* Install with some simple copy and pasting
* Install powerful cloak plugin as well
* Show QRCode and `ss://` link at the end
* User Management
* Automatic service configuration
* Automatically setup firewall
* Support Debian, Ubuntu and CentOS
## What is [Cloak](https://github.com/cbeuw/Cloak)?
A Shadowsocks plugin that obfuscates the traffic as normal HTTPS traffic to non-blocked websites through domain fronting and disguises the proxy server as a normal webserver.

Cloak multiplexes all traffic through a fixed amount of underlying TCP connections which eliminates the TCP handshake overhead when using vanilla Shadowsocks. Cloak also provides user management, allowing multiple users to connect to the proxy server using one single port. It also provides QoS controls for individual users such as upload and download credit limit, as well as bandwidth control. [Source](https://github.com/cbeuw/Cloak#cloak)
## The Script
### Compatibility
The script should work with these operating systems:
* CentOS 7
* Debian 8 / 9
* Ubuntu 16 / 18 / 19

arm, arm64, amd64 and i386 are supported.
#### Tested On
* CentOS 7 Minimal amd64
* Debian 8.11 Net install amd64
* Debian 9.9 Net install amd64
* Ubuntu 18.04 LTS Server amd64
* Ubuntu 16.04.5 LTS Server amd64
### Installing 
Copy and execute this command:
```bash
curl -o Shadowsocks-Cloak-Installer.sh -L https://git.io/fjECg && bash Shadowsocks-Cloak-Installer.sh
```
Answer questions and wait until the setup finishes installing. You can scan the QR Code after or use `ss://` link or even enter server config manually.
### Post-Install
After installing, re-run the script to either uninstall the proxy or regenerate QR code and `ss://` link and configs.

Also script creates a service named `shadowsocks-server`. **DO NOT USE shadowsocks-libev service.**
## Client Setup
### Android
On Android at first download shadowsocks client from [Google Play](https://play.google.com/store/apps/details?id=com.github.shadowsocks). Then download and install Cloak APK from [here](https://github.com/cbeuw/Cloak-android/releases). Then simply scan the QR Code generated by script.
### Linux
At first install shadowsocks-libev. [More Info](https://github.com/shadowsocks/shadowsocks-libev#installation). Download [this](https://raw.githubusercontent.com/cbeuw/Cloak/master/config/ckclient.json) file and edit it with your server arguments. Then download one of the client suitable for your linux from [here](https://github.com/cbeuw/Cloak/releases) (You may need to run `chmod +x ck-client-linux-XXX` to make it executable). Run client like this:
```bash
ss-local -s <SERVER_IP> -p <SERVER_PORT> -l 1080 -k <SERVER_PASSWORD> -m <ENCRYPTION_METHOD> --plugin path/to/ck-client-linux-XXX --plugin-opts path/to/ckclient.json
```
You can connect to your shadowsocks with socks or http proxy set on localhost and 1080 port.
### iOS
Unfortunately cloak does not support iOS. (Most of the plugins does not work with iOS) Use shadowsocks without plugin. [Here](https://github.com/teddysun/shadowsocks_install/tree/master) is a script that you can install shadowsocks without plugin on your server.
### Windows
At first install [shadowsocks windows](https://github.com/shadowsocks/shadowsocks-windows/releases). Then download cloak for windows from [here](https://github.com/cbeuw/Cloak/releases). If you are using a 32-bit system, download `ck-client-windows-386-X.exe
` if your system is 64-bit use `ck-client-windows-amd64-X.exe
`

Then use the QR Code or `ss://` link to import the server.
## Next Steps
### FAQ
[Here](https://github.com/HirbodBehnam/Shadowsocks-Cloak-Installer/wiki/FAQ)
### BBR
At first what is BBR?

**TL;DR: It speeds up TCP connections = Faster Shadowsocks server**

BBR or Bottleneck Bandwidth and Round-trip propagation time (BBR) is a TCP congestion control algorithm developed at Google in 2016. While most congestion control algorithms are loss-based, in that they rely on packet loss as a signal to lower rates of transmission, BBR is model-based. The algorithm uses the maximum bandwidth and round-trip time at which the network delivered the most recent flight of outbound data packets to build an explicit model of the network. Each cumulative or selective acknowledgment of packet delivery produces a rate sample which records the amount of data delivered over the time interval between the transmission of a data packet and the acknowledgment of that packet. As network interface controllers evolve from megabit per second to gigabit per second performance,[clarification needed] packet loss should no longer be considered the primary determining factor in identifying congestion, making model-based congestion control algorithms which provide higher throughput and lower latency, such as BBR, a more reliable alternative to more popular algorithms like CUBIC. [Source](https://en.wikipedia.org/wiki/TCP_congestion_control#TCP_BBR)
#### How to setup BBR?
The requirement to enable BBR is to have Linux Kernel 4.9 or higher. If you do, you can enable BBR like this:
```bash
echo 'net.core.default_qdisc=fq' | sudo tee -a /etc/sysctl.conf
echo 'net.ipv4.tcp_congestion_control=bbr' | sudo tee -a /etc/sysctl.conf
sysctl -p
```
To check if it is enabled:
```bash
sysctl net.ipv4.tcp_available_congestion_control
# This should include bbr in it
sysctl -n net.ipv4.tcp_congestion_control
# This one should be bbr
lsmod | grep bbr
# The output will be similar to "tcp_bbr 16384 0"
```
If your kernel is not 4.9 or higher just search how to upgrade it.

Here are some handy links to install BBR and upgrade kernel:

[CentOS](https://www.vultr.com/docs/how-to-deploy-google-bbr-on-centos-7)

[Ubuntu 16 and 17](https://www.linuxbabe.com/ubuntu/enable-google-tcp-bbr-ubuntu)
### Whole System Tunnel VPN
Shadowsocks cannot natively route all traffic. You can use some apps like SocksCap or other stuff to route applications through shadowsocks.

If you want a VPN you can use [wireguard](https://github.com/l-n-s/wireguard-install) or [openvpn](https://github.com/angristan/openvpn-install).
### Server
You can use any VPS or Dedicated Server. If you want a cheap and low-end server, I personally recommend to buy one at [Virmach](https://virmach.com/); They also accept cryptos!
### Donations
You can donate to me through bitcoin at `1XDgEkpnkJ7hC8Kwv5adfaDC1Z3FrkwsK`, Ethereum at `0xbb527a28B76235E1C125206B7CcFF944459b4894`, ZCash at `t1ZKYrYZCjxDYvo6mQaLZi3gNe2a6MydUo3` and Bitcoin Gold at `GcNgxfyR3nnAsD3Nhuckvq14sXYuDFkK9P`
